import{c as w,j as e,r as h,X as R,S as B,y as g,R as W,s as N}from"./index-DGgLp9iC.js";import{C as U}from"./chevron-down-BqbkpoWc.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Y=w("activity",Z);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],H=w("calendar",G);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]],E=w("droplet",V);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],J=w("file-text",X);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],ee=w("hash",Q);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],te=w("map-pin",se);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]],K=w("medal",ne);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],re=w("paperclip",ae);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],le=w("plus",ie);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ce=w("trash-2",oe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],me=w("triangle-alert",de);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ue=w("upload",xe);function $({title:s,children:a}){return e.jsxs("section",{className:"p-6 border border-zinc-200 shadow-sm rounded-lg bg-zinc-50 flex flex-col",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("h3",{className:"text-xl font-semibold text-zinc-800",children:s})}),a]})}const I=2*1024*1024,he=130,q={krew_pelna:.45,osocze:.65,plytki:.25};function pe({isOpen:s,onClose:a,onSave:c}){const n=new Date().toISOString().split("T")[0],[l,i]=h.useState(n),[r,m]=h.useState("Krew pełna"),[x,o]=h.useState(450),[d,p]=h.useState("RCKiK Warszawa"),[f,b]=h.useState(null),[y,M]=h.useState(!1),[S,v]=h.useState(!1);if(h.useEffect(()=>(s?(document.body.style.overflow="hidden",i(n),m("Krew pełna"),o(450),p("RCKiK Warszawa"),b(null)):document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[s]),!s)return null;const L=t=>{if(t.preventDefault(),x<=0){g.error("Ilość oddanej krwi musi być większa od 0ml");return}M(!0),setTimeout(()=>{c({date:l,type:r,location:d,amount:x,file:f}),M(!1),a()},500)},z=t=>{m(t),t==="Krew pełna"&&o(450),t==="Osocze"&&o(650),t==="Płytki krwi"&&o(500)},T=t=>{if(t.target.files&&t.target.files[0]){const j=t.target.files[0];if(j.size>I){g.error("Plik jest za duży (max. 2 MB)"),t.target.value="";return}b(j)}},P=t=>{t.preventDefault(),v(!0)},O=t=>{t.preventDefault(),v(!1)},u=t=>{t.preventDefault(),v(!1),t.dataTransfer.files&&t.dataTransfer.files[0]&&b(t.dataTransfer.files[0])};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity animate-in fade-in duration-200",onClick:a,"aria-hidden":"true"}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center sm:p-6",children:e.jsxs("div",{className:"relative p-4 sm:p-6 transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 w-full max-w-lg animate-in zoom-in-95 duration-200",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex border-b border-zinc-200 pb-4 mb-4 justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-bold text-zinc-800",children:"Dodaj nową donację"}),e.jsx("button",{onClick:a,className:"p-2 rounded-md text-zinc-600 hover:text-zinc-800 transition-colors",children:e.jsx(R,{size:20})})]}),e.jsx("form",{onSubmit:L,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"date",className:"mb-1 font-medium text-zinc-600",children:"Data donacji"}),e.jsx("input",{type:"date",id:"date",required:!0,value:l,max:l,onChange:t=>i(t.target.value),className:"w-full p-2 border border-zinc-300 rounded-md focus:ring-red-500 focus:border-red-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 font-medium text-zinc-600",children:"Typ donacji"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-stretch",children:[e.jsxs("label",{className:"flex-1 flex items-center p-2.5 border border-zinc-300 rounded-md cursor-pointer hover:bg-zinc-50 transition-colors min-w-0",children:[e.jsx("input",{type:"radio",name:"donationType",value:"Krew pełna",checked:r==="Krew pełna",onChange:t=>z(t.target.value),className:"w-4 h-4 text-red-600 focus:ring-red-500 shrink-0"}),e.jsx("span",{className:"ml-2 text-sm text-zinc-700 truncate",children:"Krew pełna"})]}),e.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${r==="Krew pełna"?"w-24 opacity-100 ml-2":"w-0 opacity-0 ml-0"}`,children:e.jsxs("div",{className:"w-24 relative h-full",children:[e.jsx("input",{type:"number",value:x,onChange:t=>o(Number(t.target.value)),className:"w-full h-full p-3 pr-8 border border-zinc-300 rounded-md text-center font-medium text-zinc-700 bg-white hover:bg-zinc-50 transition-all focus:outline-none"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs font-medium text-zinc-400 pointer-events-none",children:"ml"})]})})]}),e.jsxs("div",{className:"flex items-stretch",children:[e.jsxs("label",{className:"flex-1 flex items-center p-2.5 border border-zinc-300 rounded-md cursor-pointer hover:bg-zinc-50 transition-colors min-w-0",children:[e.jsx("input",{type:"radio",name:"donationType",value:"Osocze",checked:r==="Osocze",onChange:t=>z(t.target.value),className:"w-4 h-4 text-red-600 focus:ring-red-500 shrink-0"}),e.jsx("span",{className:"ml-2 text-sm text-zinc-700 truncate",children:"Osocze (Plazma)"})]}),e.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${r==="Osocze"?"w-24 opacity-100 ml-2":"w-0 opacity-0 ml-0"}`,children:e.jsxs("div",{className:"w-24 relative h-full",children:[e.jsx("input",{type:"number",value:x,onChange:t=>o(Number(t.target.value)),className:"w-full h-full p-3 pr-8 border border-zinc-300 rounded-md text-center font-medium text-zinc-700 bg-white hover:bg-zinc-50 transition-all focus:outline-none"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs font-medium text-zinc-400 pointer-events-none",children:"ml"})]})})]}),e.jsxs("div",{className:"flex items-stretch",children:[e.jsxs("label",{className:"flex-1 flex items-center p-2.5 border border-zinc-300 rounded-md cursor-pointer hover:bg-zinc-50 transition-colors min-w-0",children:[e.jsx("input",{type:"radio",name:"donationType",value:"Płytki krwi",checked:r==="Płytki krwi",onChange:t=>z(t.target.value),className:"w-4 h-4 text-red-600 focus:ring-red-500 shrink-0"}),e.jsx("span",{className:"ml-2 text-sm text-zinc-700 truncate",children:"Płytki krwi (Trombocyty)"})]}),e.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${r==="Płytki krwi"?"w-24 opacity-100 ml-2":"w-0 opacity-0 ml-0"}`,children:e.jsxs("div",{className:"w-24 relative h-full",children:[e.jsx("input",{type:"number",value:x,onChange:t=>o(Number(t.target.value)),className:"w-full h-full p-3 pr-8 border border-zinc-300 rounded-md text-center font-medium text-zinc-700 bg-white hover:bg-zinc-50 transition-all focus:outline-none"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs font-medium text-zinc-400 pointer-events-none",children:"ml"})]})})]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"location",className:"mb-1 font-medium text-zinc-600",children:"Miejsce (Punkt)"}),e.jsx("input",{type:"text",id:"location",required:!0,value:d,onChange:t=>p(t.target.value),placeholder:"np. RCKiK Kraków",className:"w-full p-2 border border-zinc-300 rounded-md focus:ring-red-500 focus:border-red-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-1 font-medium text-zinc-600",children:"Wyniki badań (opcjonalne)"}),e.jsxs("label",{htmlFor:"file",onDragOver:P,onDragLeave:O,onDrop:u,className:`flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-lg cursor-pointer transition-colors ${S?"border-red-500 bg-red-50":"border-zinc-300 bg-zinc-50 hover:bg-zinc-100"}`,children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(ue,{className:"w-8 h-8 mb-2 text-zinc-400"}),e.jsx("p",{className:"mb-2 text-sm text-zinc-500",children:e.jsx("span",{className:"font-semibold",children:"Kliknij lub upuść plik"})}),e.jsx("p",{className:"text-xs text-zinc-500",children:"PDF, JPG, PNG (max. 2MB)"})]}),e.jsx("input",{id:"file",type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:T})]}),f&&e.jsxs("p",{className:"mt-2 text-sm text-zinc-600",children:["Wybrano plik:"," ",e.jsx("span",{className:"font-semibold",children:f.name})]})]}),e.jsxs("button",{type:"submit",disabled:y,className:"w-full bg-red-600 text-white font-semibold py-3 rounded-md hover:bg-red-700 transition-colors flex justify-center items-center gap-2 disabled:opacity-70",children:[y&&e.jsx(B,{size:"sm"}),y?"Zapisywanie...":"Zapisz"]})]})})]})})]})}function fe({isOpen:s,onClose:a,onConfirm:c}){return h.useEffect(()=>(s?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[s]),s?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity animate-in fade-in duration-200",onClick:a,"aria-hidden":"true"}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center sm:p-6",children:e.jsxs("div",{className:"relative p-4 sm:p-6 transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 w-full max-w-lg animate-in zoom-in-95 duration-200",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex border-b border-zinc-200 pb-4 mb-4 justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-bold text-zinc-800",children:"Usuń donację"}),e.jsx("button",{onClick:a,className:"p-2 rounded-md text-zinc-600 hover:text-zinc-800 transition-colors",children:e.jsx(R,{size:20})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-full shrink-0 bg-red-50 text-red-600",children:e.jsx(me,{size:24})}),e.jsx("p",{className:"text-zinc-600 mt-1",children:"Czy na pewno chcesz usunąć tę donację? Tej operacji nie można cofnąć"})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-2",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-sm font-medium text-zinc-700 bg-white border border-zinc-300 rounded-md hover:bg-zinc-50 focus:ring-zinc-500 transition-colors",children:"Anuluj"}),e.jsx("button",{type:"button",onClick:()=>{c(),a()},className:"px-4 py-2 text-sm font-medium text-white rounded-md transition-colors bg-red-600 hover:bg-red-700",children:"Usuń"})]})]})]})})]}):null}const _=s=>s==="Krew pełna"||s==="krew_pelna"?"krew_pelna":s==="Osocze"||s==="osocze"?"osocze":s==="Płytki krwi"||s==="plytki"?"plytki":"krew_pelna",be=(s,a="Krew pełna",c="Krew pełna")=>{const n=_(a),l=_(c);let i=56;n==="krew_pelna"?l==="krew_pelna"?i=56:i=28:n===l?i=14:i=2;const r=new Date(s),m=new Date;m.setHours(0,0,0,0);const x=new Date(r);x.setDate(r.getDate()+i),x.setHours(0,0,0,0);const o=x.getTime()-m.getTime(),d=Math.ceil(o/(1e3*60*60*24)),p=i-d,f=Math.min(Math.max(p/i*100,0),100);return{daysRemaining:d>0?d:0,canDonate:d<=0,nextDate:x.toLocaleDateString("pl-PL"),progress:f}},je=(s,a)=>{const c=s.filter(l=>new Date(l.date).getFullYear()===a),n=c.reduce((l,i)=>{const r=_(i.type);let m=0;return i.amount?m=i.amount/1e3:m=q[r]||0,l+m*he},0);return{amount:Math.round(n*100)/100,donationCount:c.length}},ge=s=>{const a=Math.floor(Math.abs(s)),c=a%100,n=a%10;return a===1?"donacja":c>=12&&c<=14?"donacji":n>=2&&n<=4?"donacje":"donacji"};function we({donation:s,onDelete:a,onUpload:c,onViewResult:n}){const l=h.useRef(null),i=r=>{const m=r.target.files?.[0];m&&c(s.id,m)};return e.jsxs("div",{className:"p-3 sm:p-4 bg-white border border-zinc-200 rounded-md transition-shadow hover:shadow-sm flex justify-between items-start gap-3 sm:gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 gap-y-1 mb-1.5",children:[e.jsx("p",{className:"font-semibold text-zinc-800",children:s.type}),s.amount>0&&e.jsxs("span",{className:"text-xs text-red-700 bg-red-100 px-2 py-0.5 rounded-full whitespace-nowrap",children:[s.amount," ml"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-zinc-600 mb-1",children:[e.jsx(H,{size:14,className:"shrink-0"}),e.jsx("span",{className:"mt-0.5",children:new Date(s.date).toLocaleDateString("pl-PL")})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-zinc-500",children:[e.jsx(te,{size:14,className:"shrink-0"}),e.jsx("span",{className:"mt-0.5",children:s.location})]})]}),e.jsxs("div",{className:"flex flex-col min-[360px]:flex-row gap-2 shrink-0",children:[s.results_url?e.jsx("button",{onClick:()=>n(s.results_url),className:"p-2 border cursor-pointer border-blue-200 rounded-md text-blue-500 hover:text-blue-600 hover:bg-blue-50 transition-colors",title:"Zobacz wyniki badań",children:e.jsx(J,{size:20})}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",ref:l,className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:i}),e.jsx("button",{onClick:()=>l.current?.click(),className:"p-2 border cursor-pointer border-zinc-200 rounded-md text-zinc-500 hover:text-zinc-600 hover:bg-zinc-50 transition-colors",title:"Dodaj wyniki badań",children:e.jsx(re,{size:20})})]}),e.jsx("button",{onClick:()=>a(s.id),className:"p-2 border cursor-pointer border-zinc-200 rounded-md text-zinc-500 hover:text-red-500 hover:bg-red-50 hover:border-red-200 transition-colors",title:"Usuń donację",children:e.jsx(ce,{size:20})})]})]})}const ye=({donations:s,onClick:a,onDelete:c,onUpload:n,onViewResult:l})=>e.jsxs($,{title:"Historia donacji",children:[e.jsx("div",{className:"flex flex-col grow",children:s.length===0?e.jsx("p",{className:"text-zinc-500 text-sm mb-2",children:"Brak zapisanych donacji."}):s.map((i,r)=>e.jsx("div",{className:r===s.length-1?"":"mb-3",children:e.jsx(we,{donation:i,onDelete:c,onUpload:n,onViewResult:l})}))}),e.jsxs("button",{onClick:a,className:"w-full mt-3 bg-red-600 text-white font-semibold py-2.5 px-6 rounded-md hover:bg-red-700 transition-colors flex items-center justify-center gap-2 shadow-sm",children:[e.jsx(le,{size:20}),"Dodaj donację"]})]});function Ne({daysRemaining:s,nextDate:a,progress:c,canDonate:n,targetDonationType:l,onTargetDonationTypeChange:i}){const[r,m]=h.useState(l);n&&r!==l&&m(l);const x=[{id:"krew_pelna",label:"Krew"},{id:"osocze",label:"Osocze"},{id:"plytki",label:"Płytki"}];return e.jsxs("section",{className:`p-6 rounded-lg border shadow-sm transition-all grid duration-300 ease-in-out ${n?"bg-green-50 border-green-200 grid-rows-[1fr]":"bg-white border-zinc-200 grid-rows-[0fr]"}`,children:[e.jsxs("div",{className:"flex flex-col-reverse md:flex-row md:items-center justify-between mb-1 gap-4",children:[e.jsx("h2",{className:`text-lg font-semibold ${n?"text-green-800":"text-zinc-800"}`,children:"Twój status"}),e.jsx("div",{className:`flex p-1 rounded-lg w-full md:w-auto ${n?"bg-green-900/5":"bg-zinc-100"}`,children:x.map(o=>e.jsx("button",{onClick:()=>i(o.id),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-all flex-1 md:flex-none justify-center ${l===o.id?`bg-white shadow-sm ${n?"text-green-700":"text-zinc-800"}`:`${n?"text-green-800/60 hover:text-green-800":"text-zinc-500 hover:text-zinc-700"}`}`,children:o.label},o.id))})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"min-h-10 flex items-center",children:n?e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-3xl font-bold text-green-600",children:["Możesz już oddać"," ",r==="osocze"?"osocze":r==="plytki"?"płytki krwi":"krew pełną"]})}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-4xl font-bold text-red-600 whitespace-nowrap shrink-0",children:s>1?`${s} dni`:`${s} dzień`}),e.jsx("span",{className:"text-zinc-600 font-medium leading-tight text-balance",children:l==="osocze"?"do kolejnej donacji osocza":l==="plytki"?"do kolejnej donacji płytek krwi":"do kolejnej donacji krwi pełnej"})]})}),e.jsx("div",{className:`grid transition-all duration-600 ease-in-out ${n?"grid-rows-[1fr] opacity-100 delay-1200":"grid-rows-[0fr] opacity-0"}`,children:e.jsx("div",{className:"overflow-hidden",children:e.jsx("p",{className:`font-medium transition-colors duration-300 ${n?"text-green-700 mb-1":"text-red-700"}`,children:"Już teraz udaj się do punktu krwiodawstwa i uratuj ludzkie życie"})})})]}),e.jsx("div",{className:`w-full rounded-full h-2.5 overflow-hidden transform-gpu ${n?"bg-green-200":"bg-zinc-100"}`,children:e.jsx("div",{className:`h-full rounded-full transition-[width] duration-600 ease-out ${n?"bg-green-500":"bg-red-600"}`,style:{width:n?"100%":`${c}%`}})}),e.jsx("div",{className:`grid transition-all duration-600 ease-in-out ${n?"grid-rows-[0fr] opacity-0":"grid-rows-[1fr] opacity-100 delay-1200"}`,children:e.jsx("div",{className:"overflow-hidden",children:e.jsxs("p",{className:"text-sm text-zinc-500 mt-6 text-right",children:["Przewidywana data: ",e.jsx("span",{className:"font-medium",children:a})]})})})]})]})}const ve=({donations:s})=>{const a=s.reduce((r,m)=>{const x=_(m.type);let o=0;return o=m.amount/1e3,r.total+=o,x==="krew_pelna"&&(r.krew_pelna+=o),x==="osocze"&&(r.osocze+=o),x==="plytki"&&(r.plytki_krwi+=o),r},{total:0,krew_pelna:0,osocze:0,plytki_krwi:0}),c=parseFloat(a.total.toFixed(2)),n=Math.floor(c/.45*3),l=s.length,i=s.length>0?new Date(Math.max(...s.map(r=>new Date(r.date).getTime()))):null;return e.jsx($,{title:"Statystyki",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center p-2.5 sm:p-3 bg-red-50/50 rounded-xl border border-red-200",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-red-100 text-red-600 rounded-lg shrink-0 mr-3",children:e.jsx(Y,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm sm:text-base font-medium text-zinc-700",children:"Uratowane życia"}),e.jsx("span",{className:"text-lg sm:text-xl font-bold text-red-700 leading-none mt-0.5",children:n})]})]}),e.jsxs("div",{className:"flex items-center p-2.5 sm:p-3 bg-red-50/50 rounded-xl border border-red-200",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-red-100 text-red-600 rounded-lg shrink-0 mr-3",children:e.jsx(E,{fill:"currentColor",className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm sm:text-base font-medium text-zinc-700",children:"Oddana krew pełna"}),e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-red-700 leading-none mt-0.5",children:[a.krew_pelna===0?"0":a.krew_pelna.toFixed(2)," ",e.jsx("span",{className:"text-xs sm:text-sm font-normal text-zinc-900",children:"L"})]})]})]}),a.osocze>0&&e.jsxs("div",{className:"flex items-center p-2.5 sm:p-3 bg-orange-50/50 rounded-xl border border-orange-200",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-orange-100 text-orange-600 rounded-lg shrink-0 mr-3",children:e.jsx(E,{fill:"currentColor",className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm sm:text-base font-medium text-zinc-700",children:"Oddane osocze"}),e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-orange-700 leading-none mt-0.5",children:[a.osocze===0?"0":a.osocze.toFixed(2)," ",e.jsx("span",{className:"text-xs sm:text-sm font-normal text-zinc-900",children:"L"})]})]})]}),a.plytki_krwi>0&&e.jsxs("div",{className:"flex items-center p-2.5 sm:p-3 bg-yellow-50/50 rounded-xl border border-yellow-200",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-yellow-100 text-yellow-600 rounded-lg shrink-0 mr-3",children:e.jsx(E,{fill:"currentColor",className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm sm:text-base font-medium text-zinc-700",children:"Oddane płytki krwi"}),e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-yellow-700 leading-none mt-0.5",children:[a.plytki_krwi===0?"0":a.plytki_krwi.toFixed(2)," ",e.jsx("span",{className:"text-xs sm:text-sm font-normal text-zinc-900",children:"L"})]})]})]}),e.jsxs("div",{className:"flex items-center p-2.5 sm:p-3 bg-zinc-50/50 rounded-xl border border-zinc-200",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-white text-zinc-600 rounded-lg border border-zinc-200 shrink-0 mr-3",children:e.jsx(ee,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm sm:text-base font-medium text-zinc-700",children:"Liczba donacji"}),e.jsx("span",{className:"text-lg sm:text-xl font-bold text-zinc-900 leading-none mt-0.5",children:l})]})]}),l>0&&e.jsxs("div",{className:"flex items-center p-2.5 sm:p-3 bg-zinc-50/50 rounded-xl border border-zinc-200",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-white text-zinc-600 rounded-lg border border-zinc-200 shrink-0 mr-3",children:e.jsx(H,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm sm:text-base font-medium text-zinc-700",children:"Ostatnia donacja"}),e.jsx("span",{className:"text-base sm:text-lg font-bold text-zinc-900 leading-none mt-0.5",children:i?i.toLocaleDateString("pl-PL"):"-"})]})]})]})})};function ze({donations:s}){const a=new Date().getFullYear(),[c,n]=h.useState(a),[l,i]=h.useState(!1),r=h.useRef(null);h.useEffect(()=>{const d=p=>{r.current&&!r.current.contains(p.target)&&i(!1)};return document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[]);const{amount:m,donationCount:x}=je(s,c),o=Array.from(new Set(s.map(d=>new Date(d.date).getFullYear()))).sort((d,p)=>p-d).filter(d=>d<=a);return o.includes(a)||o.unshift(a),e.jsx($,{title:"Kalkulator ulgi podatkowej",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"w-full relative",ref:r,children:[e.jsxs("button",{type:"button",className:"w-full bg-white border border-zinc-200 shadow-xs text-zinc-800 px-4 py-3 text-sm font-medium rounded-lg flex items-center justify-between transition-all hover:bg-zinc-50",onClick:()=>i(!l),children:[e.jsx("span",{children:c}),e.jsx(U,{size:16,className:`text-zinc-400 transition-transform duration-200 ${l?"rotate-180":""}`})]}),l&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-zinc-200 rounded-lg shadow-lg z-10 overflow-hidden",children:e.jsx("div",{className:"max-h-60 overflow-y-auto p-1 no-scrollbar",children:o.map(d=>e.jsxs("button",{onClick:()=>{n(d),i(!1)},className:`w-full px-3 py-2 text-sm font-medium rounded-md transition-all text-left mb-1 last:mb-0 flex items-center justify-between ${c===d?"bg-zinc-100 text-zinc-900":"text-zinc-500 hover:bg-zinc-50 hover:text-zinc-700"}`,children:[d,c===d&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-red-500"})]},d))})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-zinc-200 flex flex-col items-center justify-center text-center shadow-sm",children:[e.jsxs("span",{className:"text-zinc-800 font-bold text-3xl mt-2",children:[m.toFixed(2)," zł"]}),e.jsx("span",{className:"text-zinc-500 text-sm font-medium mt-1",children:"Wysokość ulgi podatkowej"}),e.jsxs("span",{className:"text-zinc-400 text-xs mt-0.5 mb-2",children:["Wyliczono na podstawie ",x," donacji w ",c," ","roku"]})]})]}),e.jsx("a",{href:"https://www.gov.pl/web/nck/po-donacji",target:"_blank",rel:"noopener noreferrer",className:"font-semibold mt-2 text-red-600 hover:underline text-xs text-center block transition-colors",children:"Dowiedz się więcej o uldze podatkowej dla krwiodawców"})]})})}const ke=[{id:"zhdk-bronze",name:"Zasłużony Honorowy Dawca Krwi III Stopnia",description:"Oddano 6 litrów (mężczyźni) lub 5 litrów (kobiety) krwi.",colors:{bg:"bg-amber-800/10",text:"text-amber-900",border:"border-amber-800",progress:"bg-amber-800"},thresholdLiters:s=>s==="male"?6:5},{id:"zhdk-silver",name:"Zasłużony Honorowy Dawca Krwi II Stopnia",description:"Oddano 12 litrów (mężczyźni) lub 10 litrów (kobiety) krwi.",colors:{bg:"bg-zinc-500/15",text:"text-zinc-600",border:"border-zinc-500",progress:"bg-zinc-500"},thresholdLiters:s=>s==="male"?12:10},{id:"zhdk-gold",name:"Zasłużony Honorowy Dawca Krwi I Stopnia",description:"Oddano 18 litrów (mężczyźni) lub 15 litrów (kobiety) krwi.",colors:{bg:"bg-yellow-500/15",text:"text-yellow-600",border:"border-yellow-500",progress:"bg-yellow-500"},thresholdLiters:s=>s==="male"?18:15},{id:"hdk-zdzn",name:"Honorowy Dawca Krwi - Zasłużony dla Zdrowia Narodu",description:"Oddano 20 litrów krwi.",colors:{bg:"bg-slate-600/15",text:"text-slate-600",border:"border-slate-700",progress:"bg-slate-600"},thresholdLiters:()=>20}],A=({donations:s,gender:a})=>h.useMemo(()=>{const n=s.reduce((p,f)=>{let b=0;if(f.amount)b=f.amount/1e3;else{const y=_(f.type);b=q[y]||0}return p+b},0),l=ke.map(p=>{const f=p.thresholdLiters(a),b=n>=f;return{...p,isUnlocked:b,threshold:f}}),i=l.filter(p=>p.isUnlocked),r=l.find(p=>!p.isUnlocked),m=i.at(-1)||null;let x=0,o=0,d=0;if(r){d=r.threshold;const p=m?m.threshold:0,f=d-p,b=n-p;x=Math.min(Math.max(b/f*100,0),100),o=Math.max(0,d-n)}else m&&(x=100,d=m.threshold);return{totalLiters:n,badges:l,currentBadge:m,nextBadge:r,progress:x,missingLiters:o.toFixed(2),nextGoalValue:d}},[s,a]),De=({donations:s,gender:a})=>{const{nextBadge:c,currentBadge:n,progress:l,missingLiters:i}=A({donations:s,gender:a}),r=Math.ceil(parseFloat(i)/.45),m=Number(Number(i).toFixed(2)),x=ge(r);if(!c&&n)return e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${n.colors.bg}`,children:e.jsx(K,{className:`w-6 h-6 ${n.colors.text}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-zinc-500",children:"Osiągnięto cel"}),e.jsx("h3",{className:"text-lg font-bold text-zinc-800",children:n.name})]})]})});const o=c||n;return o?e.jsxs("div",{className:"flex flex-col gap-4 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${o.colors.bg}`,children:e.jsx(K,{className:`w-6 h-6 ${o.colors.text}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-zinc-500",children:"Następny cel"}),e.jsx("h3",{className:"text-lg font-bold text-zinc-800",children:o.name})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-full bg-zinc-100 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-1000 ease-out ${o.colors.progress}`,style:{width:`${l}%`}})}),e.jsxs("p",{className:"text-sm text-zinc-600",children:["Brakuje Ci ",e.jsxs("span",{className:"font-bold",children:[m," L"]})," (ok."," ",r," ",x,")"]})]})]}):null},_e=({donations:s,gender:a})=>{const{badges:c}=A({donations:s,gender:a}),[n,l]=h.useState(!1);return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("span",{className:"font-medium text-zinc-700",children:"Galeria odznak"}),e.jsx("button",{onClick:()=>l(!n),className:"p-2 rounded-md hover:bg-zinc-100 transition-colors","aria-label":n?"Zwiń galerię":"Rozwiń galerię",children:e.jsx(U,{className:`shrink-0 transition-transform duration-200 ${n?"rotate-180":""}`,size:20})})]}),e.jsx("div",{className:`grid transition-all duration-300 ease-in-out ${n?"grid-rows-[1fr] opacity-100":"grid-rows-[0fr] opacity-0"}`,children:e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 pt-4",children:c.map(i=>{const r=i.isUnlocked;return e.jsxs("div",{className:`
                    relative flex flex-col items-center justify-center p-3 rounded-lg border text-center transition-all
                    ${r?`${i.colors.bg} ${i.colors.border}`:"bg-zinc-50 border-zinc-200 grayscale opacity-60"}
                  `,children:[e.jsx("div",{className:`p-2 rounded-full mb-2 ${r?"bg-white/50":"bg-zinc-200"}`,children:e.jsx(K,{className:`w-6 h-6 ${r?i.colors.text:"text-zinc-500"}`})}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:`text-xs font-bold uppercase tracking-wider ${r?i.colors.text:"text-zinc-500"}`,children:i.name}),e.jsxs("p",{className:"text-[10px] font-medium text-zinc-500",children:[i.threshold," litrów"]})]})]},i.id)})})})})]})};function $e(){const{session:s}=W.useRouteContext(),a=s.user,[c,n]=h.useState(!1),[l,i]=h.useState(null),[r,m]=h.useState([]),[x,o]=h.useState(!0),[d,p]=h.useState("krew_pelna"),f=h.useCallback(async()=>{try{const{data:u,error:t}=await N.from("donations").select("*").order("date",{ascending:!1}).order("created_at",{ascending:!1});if(t)throw t;u&&m(u)}catch(u){console.error(u),g.error("Nie udało się pobrać historii donacji.")}finally{o(!1)}},[]);h.useEffect(()=>{f()},[f]);const b=r[0],{daysRemaining:y,nextDate:M,progress:S,canDonate:v}=b?be(b.date,b.type,d):{daysRemaining:0,nextDate:new Date().toLocaleDateString("pl-PL"),progress:100,canDonate:!0},L=async u=>{try{let t=null;if(u.file){if(u.file.size>I){g.error("Plik jest za duży (max. 2 MB)");return}const F=u.file.name.split(".").pop(),C=`${Math.random()}.${F}`,k=`${a.id}/${Date.now()}_${C}`,{error:D}=await N.storage.from("donation-results").upload(k,u.file);if(D)throw D;t=k}const{error:j}=await N.from("donations").insert([{user_id:a.id,date:u.date,type:u.type,location:u.location,amount:u.amount,results_url:t}]);if(j)throw j;await f(),g.success("Dodano nową donację"),n(!1)}catch(t){console.error(t),g.error("Nie udało się zapisać donacji. Spróbuj ponownie.")}},z=u=>{i(u)},T=async()=>{if(l)try{const{error:u}=await N.from("donations").delete().eq("id",l);if(u)throw u;await f(),g.success("Donacja została usunięta")}catch(u){console.error(u),g.error("Nie udało się usunąć donacji. Spróbuj ponownie")}finally{i(null)}},P=async(u,t)=>{if(t.size>I){g.error("Plik jest za duży (max. 2 MB)");return}try{const j=t.name.split(".").pop(),F=`${Math.random()}.${j}`,C=`${a.id}/${Date.now()}_${F}`,{error:k}=await N.storage.from("donation-results").upload(C,t);if(k)throw k;const{error:D}=await N.from("donations").update({results_url:C}).eq("id",u);if(D)throw D;await f(),g.success("Wyniki badań zostały zapisane")}catch(j){console.error(j),g.error("Nie udało się przesłać pliku. Spróbuj ponownie.")}},O=async u=>{try{const{data:t,error:j}=await N.storage.from("donation-results").createSignedUrl(u,60);if(j)throw j;t&&window.open(t.signedUrl,"_blank")}catch(t){console.error(t),g.error("Nie udało się otworzyć pliku. Spróbuj ponownie")}};return x?e.jsx("div",{className:"flex justify-center items-center h-[50vh]",children:e.jsx(B,{size:"lg"})}):e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8 pb-12",children:[e.jsxs("h1",{className:"text-3xl font-bold text-zinc-800",children:["Hej,"," ",e.jsx("span",{className:"text-red-600",children:a?.user_metadata.first_name||"krwiodawco"}),". Dziękujemy za ratowanie życia."]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(Ne,{nextDate:M,progress:S,daysRemaining:y,canDonate:v,targetDonationType:d,onTargetDonationTypeChange:p}),e.jsx(ye,{donations:r,onClick:()=>n(!0),onDelete:z,onUpload:P,onViewResult:O})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs($,{title:"Odznaki",children:[e.jsx(De,{donations:r,gender:a?.user_metadata?.gender}),e.jsx("div",{className:"my-4 border-t border-zinc-200"}),e.jsx(_e,{donations:r,gender:a?.user_metadata?.gender})]}),e.jsx(ve,{donations:r}),e.jsx(ze,{donations:r})]})]}),e.jsx(pe,{isOpen:c,onClose:()=>n(!1),onSave:L}),e.jsx(fe,{isOpen:l!==null,onClose:()=>i(null),onConfirm:T})]})}export{$e as component};
